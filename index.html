<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạp Hóa Hường Quyền</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
        }
        .cart-item-list { max-height: 450px; overflow-y: auto; }
        .product-image {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .card-title { font-size: 0.9rem; line-height: 1.2rem; height: 2.4rem; overflow: hidden; }
        .card-price { font-size: 1rem; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
        <div class="w-7/12 p-4 flex flex-col border-r bg-white overflow-y-auto">
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="Tìm tên sản phẩm..." class="w-full p-2 border-2 border-blue-100 rounded-lg shadow-sm focus:border-blue-500 outline-none transition-all">
            </div>
            
            <div class="flex gap-2 mb-4 overflow-x-auto pb-2 items-center scrollbar-hide">
                <button onclick="filterCategory('All')" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-full hover:bg-blue-700 transition whitespace-nowrap">Tất cả</button>
                <button onclick="filterCategory('Bánh kẹo')" class="px-3 py-1 bg-white border text-sm rounded-full hover:bg-gray-100 transition whitespace-nowrap">Bánh kẹo</button>
                <button onclick="filterCategory('Gia vị')" class="px-3 py-1 bg-white border text-sm rounded-full hover:bg-gray-100 transition whitespace-nowrap">Gia vị</button>
                <button onclick="filterCategory('Nước giải khát')" class="px-3 py-1 bg-white border text-sm rounded-full hover:bg-gray-100 transition whitespace-nowrap">Nước giải khát</button>
                <button onclick="filterCategory('Mì tôm')" class="px-3 py-1 bg-white border text-sm rounded-full hover:bg-gray-100 transition whitespace-nowrap">Mì tôm</button>
            </div>

            <div id="productGrid" class="product-grid">
                </div>
        </div>

        <div class="w-5/12 p-4 bg-gray-50 flex flex-col justify-between shadow-xl border-l">
            <div>
                <h2 class="text-xl font-black mb-4 text-gray-800 border-b-2 border-blue-500 pb-2">HÓA ĐƠN</h2>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="customerName" placeholder="Tên khách hàng..." class="w-full p-2 text-sm bg-white border rounded focus:border-blue-500 outline-none">
                </div>
                
                <div id="cartItems" class="cart-item-list space-y-2 pr-1">
                    <p class="text-center text-gray-400 mt-10 text-sm italic">Giỏ hàng trống</p>
                </div>
            </div>

            <div class="border-t pt-4 mt-2 bg-gray-50 sticky bottom-0">
                <div class="flex justify-between text-xl font-black text-blue-800 px-2">
                    <span>TỔNG:</span>
                    <span id="totalAmount">0đ</span>
                </div>
                
                <div class="mt-4 p-3 bg-white rounded-xl shadow-sm border">
                    <p class="text-xs font-bold text-gray-500 mb-2 uppercase">Khách đưa:</p>
                    <div class="grid grid-cols-4 gap-1 mb-2">
                        <button onclick="setCash(50000)" class="bg-gray-100 hover:bg-blue-100 py-1 rounded text-sm font-bold transition">50k</button>
                        <button onclick="setCash(100000)" class="bg-gray-100 hover:bg-blue-100 py-1 rounded text-sm font-bold transition">100k</button>
                        <button onclick="setCash(200000)" class="bg-gray-100 hover:bg-blue-100 py-1 rounded text-sm font-bold transition">200k</button>
                        <button onclick="setCash(500000)" class="bg-gray-100 hover:bg-blue-100 py-1 rounded text-sm font-bold transition">500k</button>
                    </div>
                    <input type="number" id="cashReceived" oninput="calculateChange()" class="w-full p-2 border-2 border-gray-300 rounded-lg text-right text-xl font-bold text-green-700 focus:border-green-500 outline-none" placeholder="0">
                    
                    <div class="flex justify-between items-center mt-3 pt-2 border-t border-dashed">
                        <span class="font-bold text-gray-600">Tiền thừa:</span>
                        <span id="changeDue" class="text-lg font-black text-orange-600">0đ</span>
                    </div>
                </div>

                <button onclick="checkout()" class="w-full bg-blue-600 text-white py-3 rounded-lg mt-4 font-bold text-lg hover:bg-blue-700 transition shadow-md">
                    THANH TOÁN NGAY
                </button>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 w-7/12 p-2 bg-gray-800 text-white hidden z-50" id="historyPanel">
         <div class="flex justify-between items-center mb-1">
             <h3 class="font-bold text-xs text-yellow-400">Giao dịch gần nhất</h3>
             <button onclick="document.getElementById('historyPanel').classList.add('hidden')" class="text-xs bg-gray-600 px-2 rounded hover:bg-gray-500">Đóng</button>
         </div>
         <div id="historyLog" class="text-xs max-h-20 overflow-y-auto"></div>
    </div>

    <script>
        // Dữ liệu mẫu
        const products = [
            { id: 1, name: 'Bánh Quy Oreo Socola', price: 15000, category: 'Bánh kẹo', img: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?q=80&w=200&auto=format&fit=crop' },
            { id: 2, name: 'Coca Cola Lon 330ml', price: 12000, category: 'Nước giải khát', img: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?q=80&w=200&auto=format&fit=crop' },
            { id: 3, name: 'Mì Hảo Hảo Tôm Chua Cay', price: 5000, category: 'Mì tôm', img: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?q=80&w=200&auto=format&fit=crop' },
            { id: 4, name: 'Nước mắm Nam Ngư', price: 42000, category: 'Gia vị', img: 'https://images.unsplash.com/photo-1589113103503-49654d88b75f?q=80&w=200&auto=format&fit=crop' },
            { id: 5, name: 'Kẹo dẻo Haribo Gấu', price: 25000, category: 'Bánh kẹo', img: 'https://images.unsplash.com/photo-1582050048266-3d70f0f5b12f?q=80&w=200&auto=format&fit=crop' },
            { id: 6, name: 'Pepsi Không Calo Lon', price: 11000, category: 'Nước giải khát', img: 'https://images.unsplash.com/photo-1543253687-c931c8e01820?q=80&w=200&auto=format&fit=crop' },
            { id: 7, name: 'Snack Khoai Tây Lay\'s', price: 18000, category: 'Bánh kẹo', img: 'https://images.unsplash.com/photo-1566478919030-261443943938?q=80&w=200&auto=format&fit=crop' },
             { id: 8, name: 'Tương Ớt Chinsu', price: 15000, category: 'Gia vị', img: 'https://images.unsplash.com/photo-1604634077373-a29a89938c6a?q=80&w=200&auto=format&fit=crop' }
        ];

        let cart = [];
        let currentTotal = 0;

        function renderProducts(filter = 'All') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            const filtered = products.filter(p => filter === 'All' || p.category === filter);
            
            filtered.forEach(p => {
                grid.innerHTML += `
                    <div onclick="addToCart(${p.id})" class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md cursor-pointer transition-all border hover:border-blue-400 group">
                        <img src="${p.img}" class="product-image group-hover:opacity-90 transition-opacity">
                        <div class="p-2 text-center">
                            <p class="card-title font-semibold text-gray-700 mb-1">${p.name}</p>
                            <p class="card-price text-blue-600 font-bold">${p.price.toLocaleString()}đ</p>
                        </div>
                    </div>
                `;
            });
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const item = cart.find(c => c.id === id);
            if(item) { item.qty++; } else { cart.push({...product, qty: 1}); }
            renderCart();
        }

        function updateQty(id, delta) {
            const item = cart.find(c => c.id === id);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) cart = cart.filter(c => c.id !== id);
            }
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cartItems');
            const totalEl = document.getElementById('totalAmount');
            
            if(cart.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-400 mt-10 text-sm italic">Giỏ hàng trống</p>';
                totalEl.innerText = '0đ';
                currentTotal = 0;
                calculateChange(); 
                return;
            }
            
            container.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price * item.qty;
                container.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm border-l-2 border-blue-500 text-sm">
                        <div class="flex-1 truncate mr-2">
                            <p class="font-bold text-gray-800 truncate">${item.name}</p>
                            <p class="text-xs text-blue-500">${item.price.toLocaleString()}đ x ${item.qty} = ${(item.price * item.qty).toLocaleString()}đ</p>
                        </div>
                        <div class="flex items-center gap-1 bg-gray-100 p-1 rounded">
                            <button onclick="updateQty(${item.id}, -1)" class="w-6 h-6 flex items-center justify-center bg-white rounded shadow hover:bg-red-50 text-red-500 font-bold">-</button>
                            <span class="w-5 text-center font-bold text-xs">${item.qty}</span>
                            <button onclick="updateQty(${item.id}, 1)" class="w-6 h-6 flex items-center justify-center bg-white rounded shadow hover:bg-green-50 text-green-500 font-bold">+</button>
                        </div>
                    </div>
                `;
            });
            currentTotal = total; 
            totalEl.innerText = total.toLocaleString() + 'đ';
            calculateChange(); 
        }

        function calculateChange() {
            const cashInput = document.getElementById('cashReceived').value;
            const cash = parseInt(cashInput) || 0;
            const changeEl = document.getElementById('changeDue');

            if (currentTotal > 0 && cash >= currentTotal) {
                const change = cash - currentTotal;
                changeEl.innerText = change.toLocaleString() + 'đ';
                changeEl.className = "text-lg font-black text-orange-600"; 
            } else if (currentTotal > 0 && cash > 0 && cash < currentTotal) {
                changeEl.innerText = "Thiếu " + (currentTotal - cash).toLocaleString() + "đ";
                changeEl.className = "text-lg font-black text-red-500"; 
            } else {
                changeEl.innerText = '0đ';
                changeEl.className = "text-lg font-black text-orange-600";
            }
        }

        function filterCategory(cat) { renderProducts(cat); }

        function setCash(amount) {
            document.getElementById('cashReceived').value = amount;
            calculateChange(); 
        }

        function checkout() {
            calculateChange(); 
            if(cart.length === 0) return alert("Vui lòng chọn sản phẩm!");
            
            const cash = parseInt(document.getElementById('cashReceived').value) || 0;
            const customer = document.getElementById('customerName').value || "Khách lẻ";
            const now = new Date().toLocaleString('vi-VN', {hour12: false});

            if(cash < currentTotal) return alert("Tiền khách đưa chưa đủ!");

            const change = cash - currentTotal;

            document.getElementById('historyPanel').classList.remove('hidden');
            const log = `<div class="border-b border-gray-700 py-1">Done: ${now} | ${customer} | Thu: ${currentTotal.toLocaleString()}đ | Thừa: ${change.toLocaleString()}đ</div>`;
            const history = document.getElementById('historyLog');
            history.innerHTML = log + history.innerHTML;

            // Reset
            cart = [];
            document.getElementById('cashReceived').value = '';
            document.getElementById('customerName').value = '';
            renderCart(); 

        document.getElementById('searchInput').addEventListener('input', function(e) {
            const val = e.target.value.toLowerCase();
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            products.filter(p => p.name.toLowerCase().includes(val)).forEach(p => {
                 grid.innerHTML += `
                    <div onclick="addToCart(${p.id})" class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md cursor-pointer transition-all border hover:border-blue-400 group">
                        <img src="${p.img}" class="product-image group-hover:opacity-90 transition-opacity">
                        <div class="p-2 text-center">
                            <p class="card-title font-semibold text-gray-700 mb-1">${p.name}</p>
                            <p class="card-price text-blue-600 font-bold">${p.price.toLocaleString()}đ</p>
                        </div>
                    </div>
                `;
            });
        });

        renderProducts();
    </script>
</body>
</html>
