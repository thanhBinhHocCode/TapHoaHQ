<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống POS Bán Hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }
        .cart-item-list { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
        <div class="w-7/12 p-4 flex flex-col border-r bg-white">
            <div class="mb-4 flex gap-2">
                <input type="text" id="searchInput" placeholder="Tìm tên sản phẩm..." class="w-full p-2 border rounded shadow-sm">
            </div>
            
            <div class="flex gap-2 mb-4 overflow-x-auto pb-2 border-b">
                <button onclick="filterCategory('All')" class="px-4 py-2 bg-blue-500 text-white rounded">Tất cả</button>
                <button onclick="filterCategory('Bánh kẹo')" class="px-4 py-2 bg-gray-200 rounded">Bánh kẹo</button>
                <button onclick="filterCategory('Gia vị')" class="px-4 py-2 bg-gray-200 rounded">Gia vị</button>
                <button onclick="filterCategory('Nước giải khát')" class="px-4 py-2 bg-gray-200 rounded">Nước giải khát</button>
                <button onclick="filterCategory('Mì tôm')" class="px-4 py-2 bg-gray-200 rounded">Mì tôm</button>
            </div>

            <div id="productGrid" class="product-grid">
                </div>
        </div>

        <div class="w-5/12 p-4 bg-gray-50 flex flex-col justify-between">
            <div>
                <h2 class="text-xl font-bold mb-4 border-b pb-2">Hóa Đơn</h2>
                <input type="text" id="customerName" placeholder="Tên khách hàng" class="w-full mb-3 p-2 border rounded">
                
                <div id="cartItems" class="cart-item-list space-y-2">
                    </div>
            </div>

            <div class="border-t pt-4">
                <div class="flex justify-between text-lg font-bold">
                    <span>Tổng cộng:</span>
                    <span id="totalAmount">0đ</span>
                </div>
                
                <div class="mt-4">
                    <p class="text-sm mb-1">Tiền khách đưa:</p>
                    <div class="grid grid-cols-4 gap-2 mb-2">
                        <button onclick="setCash(50000)" class="bg-white border p-1 rounded">50k</button>
                        <button onclick="setCash(100000)" class="bg-white border p-1 rounded">100k</button>
                        <button onclick="setCash(200000)" class="bg-white border p-1 rounded">200k</button>
                        <button onclick="setCash(500000)" class="bg-white border p-1 rounded">500k</button>
                    </div>
                    <input type="number" id="cashReceived" class="w-full p-2 border rounded text-right text-xl" placeholder="Nhập số tiền...">
                </div>

                <button onclick="checkout()" class="w-full bg-green-600 text-white py-3 rounded-lg mt-4 font-bold text-lg hover:bg-green-700">
                    THANH TOÁN (IN HÓA ĐƠN)
                </button>
            </div>
        </div>
    </div>

    <div class="p-4 bg-white mt-4 border-t">
        <h3 class="font-bold">Lịch sử giao dịch gần đây</h3>
        <div id="historyLog" class="text-sm text-gray-600 mt-2"></div>
    </div>

    <script>
        // Data giả lập
        const products = [
            { id: 1, name: 'Oishi Cay', price: 10000, category: 'Bánh kẹo', img: 'https://via.placeholder.com/80' },
            { id: 2, name: 'Coca Cola', price: 12000, category: 'Nước giải khát', img: 'https://via.placeholder.com/80' },
            { id: 3, name: 'Hảo Hảo', price: 5000, category: 'Mì tôm', img: 'https://via.placeholder.com/80' },
            { id: 4, name: 'Nước mắm Nam Ngư', price: 35000, category: 'Gia vị', img: 'https://via.placeholder.com/80' },
        ];

        let cart = [];

        // Hiển thị sản phẩm
        function renderProducts(filter = 'All') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            products.filter(p => filter === 'All' || p.category === filter).forEach(p => {
                grid.innerHTML += `
                    <div onclick="addToCart(${p.id})" class="bg-white border p-2 rounded shadow hover:border-blue-500 cursor-pointer text-center">
                        <img src="${p.img}" class="mx-auto mb-2">
                        <p class="font-bold text-sm">${p.name}</p>
                        <p class="text-red-500 font-semibold">${p.price.toLocaleString()}đ</p>
                    </div>
                `;
            });
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const item = cart.find(c => c.id === id);
            if(item) { item.qty++; } else { cart.push({...product, qty: 1}); }
            renderCart();
        }

        function updateQty(id, delta) {
            const item = cart.find(c => c.id === id);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) cart = cart.filter(c => c.id !== id);
            }
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cartItems');
            const totalEl = document.getElementById('totalAmount');
            container.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                total += item.price * item.qty;
                container.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                        <div class="w-1/2">
                            <p class="font-semibold text-sm">${item.name}</p>
                            <p class="text-xs text-gray-500">${item.price.toLocaleString()}đ</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateQty(${item.id}, -1)" class="px-2 bg-gray-200 rounded">-</button>
                            <span class="w-6 text-center">${item.qty}</span>
                            <button onclick="updateQty(${item.id}, 1)" class="px-2 bg-gray-200 rounded">+</button>
                        </div>
                    </div>
                `;
            });
            totalEl.innerText = total.toLocaleString() + 'đ';
        }

        function setCash(amount) {
            document.getElementById('cashReceived').value = amount;
        }

        function checkout() {
            if(cart.length === 0) return alert("Giỏ hàng trống!");
            const total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
            const cash = document.getElementById('cashReceived').value;
            const customer = document.getElementById('customerName').value || "Khách lẻ";
            const now = new Date().toLocaleString('vi-VN');

            if(cash < total) return alert("Tiền khách đưa không đủ!");

            const log = `[${now}] ${customer} - Tổng: ${total.toLocaleString()}đ (Thối: ${(cash - total).toLocaleString()}đ)`;
            const history = document.getElementById('historyLog');
            history.innerHTML = `<p>${log}</p>` + history.innerHTML;

            alert("Thanh toán thành công!\nTiền thối: " + (cash - total).toLocaleString() + "đ");
            cart = [];
            document.getElementById('cashReceived').value = '';
            document.getElementById('customerName').value = '';
            renderCart();
        }

        renderProducts();
    </script>
</body>
</html>
